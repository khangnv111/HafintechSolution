
@{
    ViewBag.Title = "ViewDecla"; 
}

<div id="loginbox" style="width: 100%">
	<div id="pop_decla">
		<div class="control-group normal_text" style="width: 100%">
			<b style="font-size:18px; text-transform: uppercase">
				THÔNG TIN CHI TIẾT TỜ KHAI SỐ: {{data.dclNoVnaccs}}
			</b>
			<b v-on:click="ClosePop()" class="icClose">X</b>
		</div>
		<div class="container-fluid" style="margin-top: 20px; max-height: 700px; overflow-y: auto">
			<div>
				<div class="row-fluid">
					<b> MÃ SOI CHIẾU SỐ: </b> @ViewBag.verifyCode
				</div>
				<div class="row-fluid">
					Lô hàng số: 1
				</div>
				<div class="row-fluid">
					Mã Barcode: @ViewBag.barCode
				</div>
				<div class="row-fluid">
					Tờ khai số:   {{data.dclNoVnaccs}}
				</div>
			</div>
			<div class="row-fluid" style="margin: 25px 0">
				<div style="margin-bottom: 20px; border-bottom: 1px solid #808080;">
					<a class="btn" v-bind:class="{'btn-info':tabInfo == 1}" v-on:click="selectTabInfo(1)"> Thông tin</a>
					<a class="btn" v-bind:class="{'btn-info':tabInfo == 2}" v-on:click="selectTabInfo(2)"> Danh sách hàng hóa</a>
				</div>
				<div class="row-fluid" v-show="tabInfo == 1">
					<div class="row">
						<div class="span2">
							<b>Loại tờ khai</b>
						</div>
						<div class="span2">
							<input type="text" class="span11" disabled v-model="data.type" />
						</div>
					</div>
					<div class="row">
						<div class="span2">
							<b>Số tờ khai</b>
						</div>
						<div class="span2">
							<input type="text" class="span11" disabled v-model="data.dclNoVnaccs"/>
						</div>

						<div class="span2">
							<b>Thông quan</b>
						</div>
						<div class="span2">
							<input type="text" class="span11" disabled v-model="data.clearanStatus"/>
						</div>

						<div class="span2">
							<b>Phân luồng</b>
						</div>
						<div class="span2">
							<span v-if="data.insClsCd == 1">Xanh</span>
							<span v-if="data.insClsCd == 2">Vàng</span>
							<span v-if="data.insClsCd == 3">Đỏ</span>
						</div>
					</div>
					<div class="row">
						<div class="span2">
							<b>Mã barcode</b>
						</div>
						<div class="span2">
							<input type="text" class="span11" disabled v-model="data.barCode"/>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 1 || typeDecla == 2">
						<div class="span2">
							Mã loại hình
						</div>
						<div class="span4">
							<input type="text" class="span4" disabled v-model="data.dclKindCd"/>
							<input type="text" class="span7" disabled />
						</div>
					</div>

					<div class="row">
						<div v-if="typeDecla == 1 || typeDecla == 2">
							<div class="span2">
								Mã phân loại hàng hóa
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.cargoClsCd"/>
								<input type="text" class="span7" disabled />
							</div>
						</div>
						<div v-if="typeDecla == 1 || typeDecla == 3">
							<div class="span2">
								<span>Phân loại tổ chức cá nhân</span>
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.clsOrg"/>
								<input type="text" class="span7" disabled />
							</div>
						</div>

						<div v-if="typeDecla == 2">
							<div class="span2">
								<span>Mã phân loại kiểm tra</span>
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled />
								<input type="text" class="span7" disabled />
							</div>
						</div>

						<div v-if="typeDecla == 4">
							<div class="span2">
								<span>Phân loại kiểm tra</span>
							</div>
							<div class="span4">
								<input type="text" class="span10" disabled />
							</div>
						</div>

						<div v-if="typeDecla == 3 || typeDecla == 4">
							<div class="span2">
								<span>Cơ quan HQ</span>
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.cstOffice"/>
								<input type="text" class="span7" disabled v-model="data.cstOfficeNm"/>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 2">
						<div class="span2">
							Mã hiệu phương thức vận chuyển
						</div>
						<div class="span5">
							<input type="text" class="span4" disabled v-model="data.meansOfTrsCd"/>
							<input type="text" class="span7" disabled />
						</div>
						<div class="span2">
							Mã số hàng hóa đại diện của tờ khai
						</div>
						<div class="span3">
							<input type="text" class="span10" disabled v-model="data.hSCd"/>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 2">
						<div class="span2">
							Mã bộ phận xử lí của tờ khai
						</div>
						<div class="span5">
							<input type="text" class="span10" disabled v-model="data.cstSubSection"/>
						</div>
					</div>

					<div class="row">
						<div class="span2">
							Mã người nhập khẩu
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.imperCd"/>
						</div>
						<div class="span2">
							Tên người nhập khẩu
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.imperNm"/>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 1">
						<div class="span2">
							Mã người ủy thác NK
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.impCtrCd"/>
						</div>
						<div class="span2">
							Tên người ủy thác NK
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.impCtrNm"/>
						</div>
					</div>

					<div class="row">
						<div class="span2">
							Mã người xuất khẩu
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.consignorCd"/>
						</div>
						<div class="span2">
							Tên người xuất khẩu
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.consignorNm"/>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 1">
						<div class="span2">
							Mã người ủy thác XK
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.expCtrCd"/>
						</div>
						<div class="span2">
							Tên người ủy thác XK
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.expCtrNm"/>
						</div>
					</div>

					<div class="row">
						<div v-if="typeDecla == 1 || typeDecla == 2">
							<div class="span2">
								<b>Số vận đơn</b>
							</div>
							<div class="span2" v-for="item in data.lsCargoNo">
								<input type="text" class="span11" disabled v-model="item.cargoNo"/>
							</div> 
						</div>
						<div v-if="typeDecla == 3">
							<div class="span2">
								<b>Số vận đơn chủ</b>
							</div>
							<div class="span2">
								<input type="text" class="span11" disabled v-model="data.cargoNo"/>
							</div>
						</div>
						<div v-if="typeDecla == 4">
							<div class="span2">
								<b>Số vận đơn</b>
							</div>
							<div class="span2">
								<input type="text" class="span11" disabled v-model="data.cargoNo"/>
							</div>
						</div>
					</div>

					<div class="row">
						<div v-if="typeDecla == 1 || typeDecla == 2">
							<div class="span2">
								Số lượng kiện
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.cargoPiece"/>
								<input type="text" class="span7" disabled v-model="data.pieceUnitCd"/>
							</div>
						</div>
						<div v-if="typeDecla == 3 || typeDecla == 4">
							<div class="span2">
								Số lượng gói
							</div>
							<div class="span2">
								<input type="text" class="span11" disabled v-model="data.cargoPiece"/>
							</div>
						</div>
						<div>
							<div class="span2">
								Tổng trọng lượng hàng
							</div>
							<div class="span4">
								<input type="text" class="span7" disabled v-model="data.cargoWeigGrs"/>
								<input type="text" class="span3" disabled v-model="data.weigUnitCdGrs"/>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 3">
						<div>
							<div class="span3">
								Địa điểm lưu hàng chờ thông quan dự kiến
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.cstWrhCd"/>
								<input type="text" class="span8" disabled v-model="data.cstClrWrhNm"/>
							</div>
						</div>
						<div>
							<div class="span2">
								Tên máy bay chờ hàng
							</div>
							<div class="span3">
								<input type="text" class="span11" disabled v-model="data.flightNo"/>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 3">
						<div>
							<div class="span2">
								Ngày hàng đến
							</div>
							<div class="span4">
								<input type="text" class="span10" disabled v-model="data.arrivalDate"/>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 4">
						<div>
							<div class="span2">
								Mã địa điểm đích cuối cùng
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.finalDesCd"/>
								<input type="text" class="span7" disabled v-model="data.finalDesNm"/>
							</div>
						</div>
						<div>
							<div class="span2">
								Mã địa điểm xếp hàng
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.loadPortCd"/>
								<input type="text" class="span7" disabled v-model="data.loadPortNm"/>
							</div>
						</div>
					</div>
					<div class="row" v-if="typeDecla == 4">
						<div>
							<div class="span3">
								Mã địa điểm lưu kho hàng chờ thông quan dự kiến
							</div>
							<div class="span6">
								<input type="text" class="span4" disabled v-model="data.cstWrhCd"/>
								<input type="text" class="span7" disabled />
							</div>
						</div>
					</div>
					<div class="row" v-if="typeDecla == 4">
						<div>
							<div class="span2">
								Tổng trị giá quy đổi
							</div>
							<div class="span3">
								<input type="text" class="span7" disabled />
								<input type="text" class="span4" disabled />
							</div>
						</div>
						<div>
							<div class="span1">
								Tổng trị giá tính thuế
							</div>
							<div class="span3">
								<input type="text" class="span7" disabled v-model="data.totalTaxVal"/>
								<input type="text" class="span4" disabled />
							</div>
						</div>
						<div>
							<div class="span1">
								Giá khai báo
							</div>
							<div class="span2">
								<input type="text" class="span11" disabled v-model="data.cstValue"/>
							</div>
							VNĐ
						</div>
					</div>

					<div class="row" v-if="typeDecla == 3">
						<div>
							<div class="span2">
								Địa điểm dỡ hàng
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.unloadPortCd"/>
								<input type="text" class="span7" disabled v-model="data.unloadPortNm"/>
							</div>
						</div>
						<div>
							<div class="span2">
								Địa điểm xếp hàng
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.loadLocCd"/>
								<input type="text" class="span7" disabled v-model="data.loadLocNm"/>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 1 || typeDecla == 2">
						<div v-if="typeDecla == 1">
							<div class="span2">
								Phân loại hình thức hóa đơn
							</div>
							<div class="span4">
								<input type="text" class="span10" disabled v-model="data.invClsCd"/>
							</div>
						</div>
						<div>
							<div class="span2">
								Số hóa đơn
							</div>
							<div class="span4">
								<input type="text" class="span10" disabled v-model="data.invNo"/>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla != 4">
						<div class="span2" v-if="typeDecla == 1 || typeDecla== 2">
							Tổng giá trị hóa đơn
						</div>
						<div class="span2" v-if="typeDecla == 3">
							Trị giá hóa đơn
						</div>
						<div class="span10">
							<input type="text" class="span5" disabled v-model="data.invPrcKindCd"/> -
							<input type="text" class="span2" disabled v-model="data.invPrcCdtCd"/> -
							<input type="text" class="span2" disabled v-model="data.invCurCd"/> -
							<input type="text" class="span3" disabled v-model="data.totalInvPrc"/>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 3 || typeDecla == 4">
						<div>
							<div class="span2">
								Mô tả hàng hóa
							</div>
							<div class="span10">
								<textarea class="span10" rows="3" disabled v-model="data.itemName"></textarea>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 3">
						<div>
							<div class="span2">
								Mã nước xuất xứ
							</div>
							<div class="span4">
								<input type="text" class="span4" disabled v-model="data.placeOriginCd"/>
								<input type="text" class="span7" disabled />
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 1 || typeDecla == 2">
						<div>
							<div class="span2">
								<b>Tổng trị giá tính thuế</b>
							</div>
							<div class="span4">
								<input type="text" class="span7" disabled v-model="data.cstValue"/>
								<input type="text" class="span4" disabled v-if="typeDecla == 2" />
							</div>
						</div>
						<div v-if="typeDecla == 1">
							<div class="span2">
								Tên sắc thuế
							</div>
							<div class="span4">
								<input type="text" class="span7" disabled v-model="data.taxSubjectNm"/>
							</div>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 1">
						<div class="span2">
							<b>Tổng tiền thuế</b>
						</div>
						<div class="span2">
							<input type="text" class="span12" disabled v-model="data.totalTaxAmt"/>
						</div>

						<div class="span2">
							Phân loại nộp thuế
						</div>
						<div class="span2">
							<input type="text" class="span12" disabled v-model="data.paymentCls"/>
						</div>

						<div class="span2">
							Tổng tiền thuế phải nộp
						</div>
						<div class="span2">
							<input type="text" class="span12" disabled v-model="data.totalPayTax"/>
						</div>
					</div>

					<div class="row" v-if="typeDecla == 1">
						<div class="span2">
							Số dòng của tờ khai
						</div>
						<div class="span4">
							<input type="text" class="span10" disabled v-model="data.noOfDclColumn"/>
						</div>
					</div>
					 
				</div>
				<div class="row-fluid" v-show="tabInfo == 2">
					<table class="table table-bordered data-table table-striped with-check" role="grid" aria-describedby="example1_info">
						<thead>
							<tr>
								<th class="text-center" style="min-width:70px">STT</th>
								<th class="text-center">Mã số hàng <br /> hóa</th>
								<th class="text-center">Tên hàng (mô tả chi tiết)</th>
								<th class="text-center">Xuất xứ</th>
								<th class="text-center">Số lượng</th>
								<th class="text-center">Số lượng <br /> thực tế</th>
								<th class="text-center">Đơn vị tính<br /> số lượng</th>
								<th class="text-center"> Đơn giá hóa đơn  </th>
								<th class="text-center">Trị giá hóa đơn</th>
								<th class="text-center">Đơn vị đơn <br /> giá hóa đơn</th>
								<th class="text-center">Khối lượng</th>
								<th class="text-center">Đơn vị tính<br /> khối lượng</th>
								<th class="text-center">Trị giá tính thuế</th>
								<th class="text-center">Mã đông tiền<br /> tính thuế</th>
							</tr>
						</thead>
						<tbody class="content-search-table"> 

							<tr v-for="(item, index) in data.listProducts">
								<td style="text-align: center">{{index + 1}}</td>
								<td>{{item.hSCd}}</td>
								<td>{{item.itemName}}</td>
								<td>{{item.placeOriginCd}}</td>
								<td>{{item.qtt1}}</td>
								<td>{{item.qtt2}}</td>
								<td>{{item.qttUnitCd1}}</td>
								<td>{{item.invUnitPrice}}</td>
								<td>{{item.invValue}}</td>
								<td>{{item.priceQttUnit}}</td>
								<td></td>
								<td></td>
								<td>{{item.cstValue}}</td>
								<td>{{item.cstValueCurCd}}</td>
							</tr>

						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	var pop = new Vue({
		el: '#pop_decla',
		data: {
			data: {
			}, 
			tabInfo: @ViewBag.tab,

			typeDecla: 1, //1: IDC - 2: EDC - 3: MIC - 4: MEC
			txtClearanStatus: "", 
		},
		methods: {
			init: function (callback) {
				var data = this.data; 

				if (callback != 'undefined' && typeof callback == 'function')
					callback();
			}, 
			getDetail: function () {

				var self = this;
				var token = $('#hdfToken').val();
				$.ajax({
					type: 'POST',
					url: Config.API_Login + "agency/ViewDeclaScan",
					data: {
						dclNo: '@ViewBag.dclNo',
					},
					headers: {
						"Authorization": "Bearer " + token
					},
					success: function (data) {

						if (data.ResponseCode >= 0) {
							self.data = data.Data;
							if (data.Data.type == "IDA" || data.Data.type == "IDB" || data.Data.type == "IDC" || data.Data.type == "IDA01" || data.Data.type == "IDD" || data.Data.type == "IDE")
								self.typeDecla = 1;
							else if (data.Data.type == "EDA" || data.Data.type == "EDB" || data.Data.type == "EDC" || data.Data.type == "EDD" || data.Data.type == "EDA01" || data.Data.type == "EDE")
								self.typeDecla = 2;
							else if (data.Data.type == "MIC" || data.Data.type == "MID" || data.Data.type == "MIE")
								self.typeDecla = 3;
							else if (data.Data.type == "MEC" || data.Data.type == "MED" || data.Data.type == "MEE")
								self.typeDecla = 4;

							if (data.Data.clearanStatus == -1)
								self.txtClearanStatus = "Chưa thông quan";
							else if (data.Data.clearanStatus == 1)
								self.txtClearanStatus = "Thông quan";
							else if (data.Data.clearanStatus == 2)
								self.txtClearanStatus = "Đợi thông quan";
						}
						else {
							bootbox.alert(data.Description);
						}
					},
					error: function (data) {
						bootbox.alert("Hệ thống bận, vui lòng quay lại sau!");
						return;
					}
				});
			},
			ClosePop: function () {
				app.showPop = false;
				$("#detal_pop").html('');
			},
			selectTabInfo: function (tab) {
				this.tabInfo = tab;
			},
		},
		mounted() {
			var self = this;
			var dclNo = '@ViewBag.dclNo';
			this.init(function () {
				if (dclNo) {
					self.getDetail(); 
				}
			});
		},

	});
</script>